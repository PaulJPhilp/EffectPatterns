---
title: "Add Custom Metrics to Your Application"
id: "observability-custom-metrics"
skillLevel: "intermediate"
useCase: ["Observability", "Metrics", "Monitoring", "Performance"]
summary: "Use Effect's Metric module to instrument your code with counters, gauges, and histograms to track key business and performance indicators."
tags: ["metrics", "observability", "monitoring", "performance", "effect"]
rule:
  description: "Use Effect's Metric module to define and update custom metrics for business and performance monitoring."
related: ["observability-structured-logging", "observability-tracing-spans"]
author: "PaulJPhilp"
---

# Add Custom Metrics to Your Application

## Guideline

Use Effect's `Metric` module to define and update custom metrics such as counters, gauges, and histograms.  
This allows you to track business events, performance indicators, and system health in a type-safe and composable way.

## Rationale

Metrics provide quantitative insight into your application's behavior and performance.  
By instrumenting your code with metrics, you can monitor key events, detect anomalies, and drive business decisions.

## Good Example

```typescript
import { Effect, Metric } from "effect";

// Define a counter metric for processed jobs
const jobsProcessed = Metric.counter("jobs_processed");

// Increment the counter when a job is processed
const processJob = Effect.gen(function* () {
  // ... process the job
  yield* Effect.log("Job processed");
  yield* Metric.increment(jobsProcessed);
});

// Define a gauge for current active users
const activeUsers = Metric.gauge("active_users");

// Update the gauge when users sign in or out
const userSignedIn = Metric.set(activeUsers, 1);  // Set to 1 (simplified example)
const userSignedOut = Metric.set(activeUsers, 0); // Set to 0 (simplified example)

// Define a histogram for request durations
const requestDuration = Metric.histogram("request_duration", [0.1, 0.5, 1, 2, 5] as any); // boundaries in seconds

// Record a request duration
const recordDuration = (duration: number) =>
  Metric.update(requestDuration, duration);
```

**Explanation:**  
- `Metric.counter` tracks counts of events.
- `Metric.gauge` tracks a value that can go up or down (e.g., active users).
- `Metric.histogram` tracks distributions (e.g., request durations).
- `Effect.updateMetric` updates the metric in your workflow.

## Anti-Pattern

Relying solely on logs for monitoring, or using ad-hoc counters and variables that are not integrated with your observability stack.