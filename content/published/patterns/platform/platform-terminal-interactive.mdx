---
title: "Platform Pattern 4: Interactive Terminal I/O"
id: platform-terminal-interactive
skillLevel: beginner
applicationPatternId: platform
summary: >-
  Use Terminal module to read user input and write formatted output,
  enabling interactive CLI applications with proper buffering and encoding.
tags:
  - platform
  - terminal
  - io
  - interactive
  - cli
  - user-input
rule:
  description: >-
    Use Terminal for user input/output in CLI applications, providing proper
    buffering and cross-platform character encoding.
related:
  - platform-pattern-command-execution
  - handle-side-effects-with-effect-sync
  - run-background-tasks-with-fork
author: effect_website
---

## Guideline

Terminal operations:

- **readLine**: Read single line of user input
- **readPassword**: Read input without echoing (passwords)
- **writeLine**: Write line with newline
- **write**: Write without newline
- **clearScreen**: Clear terminal

Pattern: `Terminal.readLine().pipe(...)`

---

## Rationale

Direct stdin/stdout causes issues:

- **No buffering**: Interleaved output in concurrent context
- **Encoding issues**: Special characters corrupted
- **Password echo**: Security vulnerability
- **No type safety**: String manipulation error-prone

Terminal enables:

- **Buffered I/O**: Safe concurrent output
- **Encoding handling**: UTF-8 and special chars
- **Password input**: No echo mode
- **Structured interaction**: Prompts and validation

Real-world example: CLI setup wizard
- **Direct**: console.log mixed with readline, no error handling
- **With Terminal**: Structured input, validation, formatted output

---

## Good Example

This example demonstrates building an interactive CLI application.

```typescript
import { Terminal, Effect } from "@effect/platform";

interface UserInput {
  readonly name: string;
  readonly email: string;
  readonly age: number;
}

const program = Effect.gen(function* () {
  console.log(`\n[INTERACTIVE CLI] User Information Form\n`);

  // Example 1: Simple prompts
  yield* Terminal.writeLine(`=== User Setup ===`);
  yield* Terminal.writeLine(``);

  yield* Terminal.write(`What is your name? `);
  const name = yield* Terminal.readLine();

  yield* Terminal.write(`What is your email? `);
  const email = yield* Terminal.readLine();

  yield* Terminal.write(`What is your age? `);
  const ageStr = yield* Terminal.readLine();

  const age = parseInt(ageStr);

  // Example 2: Display collected information
  yield* Terminal.writeLine(``);
  yield* Terminal.writeLine(`=== Summary ===`);
  yield* Terminal.writeLine(`Name: ${name}`);
  yield* Terminal.writeLine(`Email: ${email}`);
  yield* Terminal.writeLine(`Age: ${age}`);

  // Example 3: Confirmation
  yield* Terminal.writeLine(``);
  yield* Terminal.write(`Confirm information? (yes/no) `);
  const confirm = yield* Terminal.readLine();

  if (confirm.toLowerCase() === "yes") {
    yield* Terminal.writeLine(`✓ Information saved`);
  } else {
    yield* Terminal.writeLine(`✗ Cancelled`);
  }
});

Effect.runPromise(program);
```

---

## Advanced: Menu Selection

Build interactive menus:

```typescript
interface MenuOption {
  readonly label: string;
  readonly value: string;
}

const selectFromMenu = (
  prompt: string,
  options: MenuOption[]
): Effect.Effect<string> =>
  Effect.gen(function* () {
    yield* Terminal.writeLine(`\n${prompt}:`);
    yield* Terminal.writeLine(``);

    options.forEach((option, idx) => {
      console.log(`  ${idx + 1}. ${option.label}`);
    });

    yield* Terminal.writeLine(``);

    while (true) {
      yield* Terminal.write(`Select option (1-${options.length}): `);

      const input = yield* Terminal.readLine();
      const selected = parseInt(input) - 1;

      if (selected >= 0 && selected < options.length) {
        return options[selected].value;
      }

      yield* Terminal.writeLine(`Invalid selection, try again.`);
    }
  });

// Usage
const menuDemo = selectFromMenu("What would you like to do?", [
  { label: "Create new user", value: "create" },
  { label: "List users", value: "list" },
  { label: "Exit", value: "exit" },
]).pipe(
  Effect.tap((selected) =>
    Terminal.writeLine(`You selected: ${selected}`)
  )
);
```

---

## Advanced: Progress Display

Show progress during operations:

```typescript
const showProgress = (
  total: number,
  interval: number
): Effect.Effect<void> =>
  Effect.gen(function* () {
    for (let i = 0; i <= total; i++) {
      const percent = ((i / total) * 100).toFixed(0);
      const filled = Math.round((i / total) * 20);
      const empty = 20 - filled;
      const bar = `[${"=".repeat(filled)}${" ".repeat(empty)}]`;

      // Clear line and print progress
      yield* Terminal.write(
        `\r${bar} ${percent}% (${i}/${total})`
      );

      if (i < total) {
        yield* Effect.sleep(`${interval} millis`);
      }
    }

    yield* Terminal.writeLine(`\n✓ Complete`);
  });

// Usage: Show progress while processing
const processWithProgress = Effect.gen(function* () {
  yield* Terminal.writeLine(`Processing items...`);

  const total = 50;

  for (let i = 1; i <= total; i++) {
    // Simulate work
    yield* Effect.sleep("100 millis");

    // Update progress
    const percent = ((i / total) * 100).toFixed(0);
    yield* Terminal.write(
      `\rProcessing: ${percent}%`
    );
  }

  yield* Terminal.writeLine(`\n✓ Complete`);
});
```

---

## Advanced: Colored Output

Format terminal output with colors:

```typescript
enum Color {
  Reset = "\x1b[0m",
  Red = "\x1b[31m",
  Green = "\x1b[32m",
  Yellow = "\x1b[33m",
  Blue = "\x1b[34m",
  Cyan = "\x1b[36m",
}

const coloredOutput = (
  text: string,
  color: Color
): string => `${color}${text}${Color.Reset}`;

const statusReport = Effect.gen(function* () {
  yield* Terminal.writeLine(coloredOutput(`=== Status Report ===`, Color.Cyan));
  yield* Terminal.writeLine(``);

  yield* Terminal.writeLine(
    coloredOutput(`✓ Database connected`, Color.Green)
  );

  yield* Terminal.writeLine(
    coloredOutput(`⚠ Cache miss rate high`, Color.Yellow)
  );

  yield* Terminal.writeLine(
    coloredOutput(`✗ External API down`, Color.Red)
  );

  yield* Terminal.writeLine(``);
  yield* Terminal.writeLine(
    coloredOutput(`Summary: 1 OK, 1 warning, 1 error`, Color.Blue)
  );
});
```

---

## Advanced: Table Display

Display tabular data:

```typescript
interface TableRow {
  readonly [key: string]: string | number;
}

const displayTable = (
  headers: string[],
  rows: TableRow[]
): Effect.Effect<void> =>
  Effect.gen(function* () {
    // Calculate column widths
    const colWidths = headers.map((h, idx) =>
      Math.max(
        h.length,
        Math.max(...rows.map((r) => String(r[h]).length))
      )
    );

    // Print header
    const headerLine = headers
      .map((h, idx) => h.padEnd(colWidths[idx]))
      .join(" | ");

    yield* Terminal.writeLine(headerLine);
    yield* Terminal.writeLine(
      "=".repeat(headerLine.length)
    );

    // Print rows
    for (const row of rows) {
      const rowLine = headers
        .map((h, idx) =>
          String(row[h]).padEnd(colWidths[idx])
        )
        .join(" | ");

      yield* Terminal.writeLine(rowLine);
    }
  });

// Usage
const tableDemo = displayTable(
  ["ID", "Name", "Status"],
  [
    { ID: "1", Name: "Alice", Status: "Active" },
    { ID: "2", Name: "Bob", Status: "Inactive" },
    { ID: "3", Name: "Charlie", Status: "Active" },
  ]
);
```

---

## Advanced: Validation and Retry

Validate input with retry:

```typescript
const readValidated = (
  prompt: string,
  validate: (input: string) => boolean,
  errorMsg: string,
  maxRetries: number = 3
): Effect.Effect<string> =>
  Effect.gen(function* () {
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      yield* Terminal.write(`${prompt}: `);

      const input = yield* Terminal.readLine();

      if (validate(input)) {
        return input;
      }

      yield* Terminal.writeLine(
        `✗ ${errorMsg} (${maxRetries - attempt} attempts remaining)`
      );
    }

    yield* Effect.fail(
      new Error(`Validation failed after ${maxRetries} attempts`)
    );
  });

// Usage: Read valid email
const emailInput = readValidated(
  "Enter email",
  (input) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input),
  "Invalid email format",
  3
);

// Usage: Read positive number
const ageInput = readValidated(
  "Enter age",
  (input) => {
    const num = parseInt(input);
    return !isNaN(num) && num > 0 && num < 150;
  },
  "Must be a number between 1 and 149",
  3
);
```

---

## When to Use This Pattern

✅ **Use Terminal when:**

- Building interactive CLI applications
- Collecting user input
- Displaying formatted output
- Progress indicators
- Setup wizards
- System administration tools

⚠️ **Trade-offs:**

- Blocking on user input
- Terminal capabilities vary per platform
- No GUI (text-only)
- Concurrent I/O can be complex

---

## Cross-Platform Compatibility

Different terminals support different features:
- Colors: Not supported on Windows Console (legacy)
- Progress: Use carriage return (`\r`) for updates
- Unicode: Ensure UTF-8 encoding
- ANSI codes: May not work on all terminals

---

## See Also

- [Platform Pattern 1: Command Execution](./platform-pattern-command-execution.mdx) - External commands
- [Handle Side Effects with Effect.sync](./handle-side-effects-with-effect-sync.mdx) - Side effects
- [Run Background Tasks with Fork](./run-background-tasks-with-fork.mdx) - Background execution
- [Use Pipe for Composition](./use-pipe-for-composition.mdx) - Composition patterns
